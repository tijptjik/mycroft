{% extends "base.html" %}

{% block videojs %}
  <link href="{{ STATIC_URL }}js/libs/videojs/design/video-js.css" rel="stylesheet" type="text/css">
  <script src="{{ STATIC_URL }}js/libs/videojs/src/core.js"></script>
  <script src="{{ STATIC_URL }}js/libs/videojs/src/lib.js"></script>
  <script src="{{ STATIC_URL }}js/libs/videojs/src/json.js"></script>

  <script src="{{ STATIC_URL }}js/libs/videojs/src/component.js"></script>
  <script src="{{ STATIC_URL }}js/libs/videojs/src/player.js"></script>
  <script src="{{ STATIC_URL }}js/libs/videojs/src/tech.js"></script>
  <script src="{{ STATIC_URL }}js/libs/videojs/src/controls.js"></script>
  <script src="{{ STATIC_URL }}js/libs/videojs/src/events.js"></script>
  <script src="{{ STATIC_URL }}js/libs/videojs/src/tracks.js"></script>

  <script src="{{ STATIC_URL }}js/libs/videojs/tech/html5/html5.js"></script>
  <script src="{{ STATIC_URL }}js/libs/videojs/tech/flash/flash.js"></script>

  <script src="{{ STATIC_URL }}js/libs/videojs/tech/youtube/youtube.js"></script>
  
  <script src="{{ STATIC_URL }}js/libs/videojs/src/setup.js"></script>
{% endblock %}

{% block page_class %} Mycroft Lectures: {{lecture.poem.title}} {% endblock %}
{% block content %}

<div class="band">
    <div class="container">
      <div class="panelBox formBox">            
        {% if user.is_authenticated %}            
  
          <div class="lecture-description row-fluid">
            <div class="span12" >
              <h2>{{lecture.poem.title}} /<span>/ {{lecture.poem.poet.first_name}} {{lecture.poem.poet.last_name}}</span></h2>
            </div>
          </div>
          <div class="hostedWrapper">        
          <video id="lectureVideo" class="video-js vjs-default-skin" controls preload="auto" data-setup="{}">
              <source src="{{ site }}/media/{{ lecture.video.video }}" type="video/mp4" />
              <track kind="subtitles" src="{{ site }}/media/{{ lecture.video.subtitle }}" type="text/vtt" srclang="en" label="English Subtitles" />
          </video>
          </div>

        {% else %}            
          <div class="Videowrapper">
            <video id="example_video_1" class="video-js vjs-default-skin h_iframe" data-setup='{"techOrder":["youtube","html5"],"ytcontrols":true}'>
              <source src="http://www.youtube.com/watch?v={{ lecture.preview.youtube_id }}" type='video/youtube'>
            </video>
          </div>
        
          <div class="lecture-description row-fluid">
            <div class="span8" >
              <h2>{{lecture.poem.title}} /<span>/ {{lecture.poem.poet.first_name}} {{lecture.poem.poet.last_name}}</span></h2>
              <div class="innerPage">
                <p>{{lecture.synopsis}}<p>
              </div>
            </div>
            <div class="span4">
              <h2>'{{lecture.preview.title}}' <span class="badge lecture-price">${{lecture.product.price_in_dollars}}</span></h2>
              <div class="innerPage">
                <p>Checkout with Paypal and receive the full lecture instantly by e-mail.</p>
                <div class="row-fluid">
                  <div class="span9">
                    <form id="bt_form" action="https://www.sandbox.paypal.com/cgi-bin/webscr" method="post">
                      <input type="text" name="email" placeholder="Email lectures to:" id="id_email" validate="required|email">
                      <input type="hidden" id="payer_email" name="payer_email" value="">
                      <input type="hidden" id="custom" name="custom" value=""> {{ form }} 
                      <input type="hidden" name="upload" value="1">
                    </form>
                  </div> 
                  <div class="span3"><button id="submitSingle" class="my-btn-paypal" value="BUY" alt="Checkout with PayPal" title="Buy">Buy</button></div> 
                </div>
              </div>
            </div>
          </div>
        {% endif %}
    </div>  
  </div>  
</div>          

  <div class="container">
    <div class="row">
      <div class="span8 panelBox poem-box">
        <div class="tabbable tabs-left"> <!-- Only required for left/right tabs -->
          <ul class="nav nav-tabs">
            <li class="active"><a href="#tab1" data-toggle="tab">Poem</a></li>
            <li><a href="#tab2" data-toggle="tab">Lecture Notes</a></li>
          </ul>
          <div class="tab-content">
            <div class="tab-pane active" id="tab1">
              <h5 class="poem-title">{{lecture.poem.title}}</h5>
              <pre class="blockcode"><code>{{lecture.poem.text}}</code></pre>
              <h5 class="poem-footer"><br>MYCROFT LECTURES</h5>
            </div>
            <div class="tab-pane" id="tab2">
              <p>Mycroft lectures always provide sentence by sentence parsing, paraphrasing and explanation of the each poem. However, each lecture provides extra information that will enhance appreciation and understanding of the poem under discussion. This lecture includes the following areas of analysis:</p>
              <div class="notes">{% autoescape off %}{{lecture.notes}}{% endautoescape %}</div>
              <h5 class="poem-footer"><br>MYCROFT LECTURES</h5>
            </div>
          </div>
        </div>       
      </div>       
      <div class="span4 poet-box panelBox">
        <div class="section-header">
        <h2>{{lecture.poem.poet.first_name}} {{lecture.poem.poet.last_name}}</h2>
      </div>
        <div class="innerPage">
        <p><b>{{lecture.poem.poet.year_of_birth}} - {{lecture.poem.poet.year_of_death}}</p></b>
        <p>{{lecture.poem.poet.description}}</p>
      </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
<script type="text/javascript">

 var pres = document.getElementsByClassName('blockcode'), pre, code, lines, pl, cl;
        for (pl = pres.length, p = 0; p < pl; p++) {
            pre  = pres[p];
            code = pre.children[0];
            
            code.innerHTML = code.innerHTML.split("\n").map(function(line) {
                return '<span class="line">' + line + '</span>';
            }).join("\n");
            
            lines = code.getElementsByClassName('line');
            for (cl = lines.length, l = 0; l < cl; l++) {
                lines[l].style.width = pre.scrollWidth + 'px';
            }
        }

$('#submitSingle').click(function(){
  $.bt_validate.result = true;
  $('#bt_form').bt_validate()
  if($.bt_validate.blocked){ 
        return false };
  
  email = $('#id_email').serialize();
  
  $.post("/api/client/student/json/", email, function(data) {
          response = $.parseJSON( data );
          $('#custom').val(response[0]['pk']);
          $('#payer_email').val(response[0]['fields']['email']);
          $('#bt_form').submit()
      });
})

  // Once the video is ready
  _V_("lectureVideo").ready(function(){

    var myPlayer = this;    // Store the video object
    var aspectRatio = 9/16; // Make up an aspect ratio

    function resizeVideoJS(){
      // Get the parent element's actual width
      var width = document.getElementById(myPlayer.id).parentElement.offsetWidth;
      // Set width to fill parent element, Set height
      myPlayer.width(width).height( width * aspectRatio );
    }

    resizeVideoJS(); // Initialize the function
    window.onresize = resizeVideoJS; // Call the function on resize
  });

</script>
{% endblock %}

