{% extends "base.html" %}

{% block videojs %}
  <link href="{{ STATIC_URL }}js/libs/videojs/design/video-js.css" rel="stylesheet" type="text/css">
  <script src="{{ STATIC_URL }}js/libs/videojs/src/core.js"></script>
  <script src="{{ STATIC_URL }}js/libs/videojs/src/lib.js"></script>
  <script src="{{ STATIC_URL }}js/libs/videojs/src/json.js"></script>

  <script src="{{ STATIC_URL }}js/libs/videojs/src/component.js"></script>
  <script src="{{ STATIC_URL }}js/libs/videojs/src/player.js"></script>
  <script src="{{ STATIC_URL }}js/libs/videojs/src/tech.js"></script>
  <script src="{{ STATIC_URL }}js/libs/videojs/src/controls.js"></script>
  <script src="{{ STATIC_URL }}js/libs/videojs/src/events.js"></script>
  <script src="{{ STATIC_URL }}js/libs/videojs/src/tracks.js"></script>

  <script src="{{ STATIC_URL }}js/libs/videojs/tech/html5/html5.js"></script>
  <script src="{{ STATIC_URL }}js/libs/videojs/tech/flash/flash.js"></script>

  <script src="{{ STATIC_URL }}js/libs/videojs/tech/youtube/youtube.js"></script>
  
  <script src="{{ STATIC_URL }}js/libs/videojs/src/setup.js"></script>
{% endblock %}

{% block page_class %}home-page{% endblock %}
{% block content %}

<div class="band">
  <div class="row">
    <div class="container">
      <div class="videopanel panelBox">            

      {% if user.is_authenticated %}            
        <video id="lectureVideo" class="video-js vjs-default-skin" controls preload="auto" data-setup="{}">
            <source src="{{ site }}/media/lectures/digging.mp4" type="video/mp4" />
            <track kind="subtitles" src="{{ site }}/media/lectures/digging.vtt" type="text/vtt" srclang="en" label="English Subtitles" />
        </video>
      {% else %}            
          <div class="Videowrapper">
            <video id="example_video_1" class="video-js vjs-default-skin h_iframe" data-setup='{"techOrder":["youtube","html5"],"ytcontrols":true}'>
              <source src="http://www.youtube.com/watch?v=jlhIkrfWAgI" type='video/youtube'>
            </video>
            <img class="ratio" src="{{ STATIC_URL }}img/landing.png"/>
          </div>
      {% endif %}
  {% if user.is_authenticated %}            
  {% else %}            
    <div class="row">
      <div class="span7">
        <h1>'{{lecture.preview.title}}'<small>Excerpt from: {{lecture.poem.title}}</small></h1>
        <p>{{lecture.synopsis}}</p>
      </div>
      <div class="purchase span4">
        <div class="innerPage"
         <footer class="purchase">
          <p>Full Lecture <span class="lecture-price">${{lecture.product.price_in_dollars}}<span> Checkout with Paypal and receive the lecture instantly by e-mail.</p>
          <form id="bt_form" action="https://www.sandbox.paypal.com/cgi-bin/webscr" method="post">Deliver to <input type="text" name="email" placeholder="E-mail Address" id="id_email" validate="required|email">
            <input type="hidden" id="payer_email" name="payer_email" value="">
            <input type="hidden" id="custom" name="custom" value=""> {{ form }} 
            <input type="hidden" name="upload" value="1">
            <button id="submitSingle" class="btn btn-primary" value="BUY" alt="Checkout with PayPal" title="Buy">Buy</button>
          </form>
            
        </div>
      </div>
    </div>
  {% endif %}
      </div>  
    </div>  
  </div>  
</div>          

<div class="row">
  <div class="container">
    <div class="span7 well">
      <pre>{{lecture.poem.text}}</pre>
    </div>
    <div class="span4">
      <h2>{{lecture.poem.poet}}</h2>
      <p>{{lecture.poem.poet.year_of_birth}} - {{lecture.poem.poet.year_of_death}}</p>
      <p>{{lecture.poem.poet.description}}</p>
    </div>
  </div>
</div>



{% endblock %}

{% block scripts %}
<script type="text/javascript">

$('#submitSingle').click(function(){
  $.bt_validate.result = true;
  $('#bt_form').bt_validate()
  if($.bt_validate.blocked){ 
        return false };
  
  email = $('#id_email').serialize();
  
  $.post("/api/client/student/json/", email, function(data) {
          response = $.parseJSON( data );
          $('#custom').val(response[0]['pk']);
          $('#payer_email').val(response[0]['fields']['email']);
          $('#bt_form').submit()
      });
})

  // Once the video is ready
  _V_("lectureVideo").ready(function(){

    var myPlayer = this;    // Store the video object
    var aspectRatio = 9/16; // Make up an aspect ratio

    function resizeVideoJS(){
      // Get the parent element's actual width
      var width = document.getElementById(myPlayer.id).parentElement.offsetWidth;
      // Set width to fill parent element, Set height
      myPlayer.width(width).height( width * aspectRatio );
    }

    resizeVideoJS(); // Initialize the function
    window.onresize = resizeVideoJS; // Call the function on resize
  });

</script>
{% endblock %}

